function EnviraAlbumGalleriesUpdate(){EnviraAlbumGalleries.reset();var e="ul#envira-album-drag-drop-area li.envira-gallery-image";jQuery(e).each(function(){var e=jQuery.parseJSON(jQuery(this).attr("data-envira-album-gallery-model"));e.alt=EnviraAlbumStripslashes(e.alt),EnviraAlbumGalleries.add(new EnviraAlbumGallery(e))})}function EnviraAlbumStripslashes(e){return(e+"").replace(/\\(.?)/g,function(e,i){switch(i){case"\\":return"\\";case"0":return"\x00";case"":return"";default:return i}})}jQuery(document).ready(function($){$("a.envira-album-galleries-delete").click(function(e){e.preventDefault();var i=confirm(envira_albums_metabox.remove_multiple);if(!i)return!1;var a=[];$("ul#envira-album-drag-drop-area > li.selected").each(function(){$(this).parent().appendTo($(envira_album_available_galleries)).draggable(envira_album_draggable_options)}),$(envira_album_selected_galleries).trigger("sortupdate")}),$("#envira-albums").on("click",".envira-gallery-remove-image",function(e){e.preventDefault();var i=confirm(envira_albums_metabox.remove);i&&($(this).parent().appendTo($(envira_album_available_galleries)).draggable(envira_album_draggable_options),$(envira_album_selected_galleries).trigger("sortupdate"))})}),wp.media.view.EnviraAlbumError=wp.Backbone.View.extend({tagName:"div",className:"notice error envira-albums-error",render:function(){return this.template=wp.media.template("envira-albums-error"),this.$el.html(this.template(this.model)),this}}),wp.media.view.EnviraAlbumItem=wp.Backbone.View.extend({tagName:"li",className:"attachment envira-gallery-item",template:wp.template("envira-albums-item"),render:function(){return this.$el.html(this.template(this.model.toJSON())),this.model.get("is_cover_image")&&this.$el.addClass("selected"),this}});var EnviraAlbumGallery=Backbone.Model.extend({defaults:{id:"",title:"",caption:"",alt:"",cover_image_id:"",cover_image_url:"",link_new_window:"",gallery_lightbox:"1",cover_image_url_thumb:""}}),EnviraAlbumGalleryImage=Backbone.Model.extend({defaults:{id:"",title:"",src:"",thumb:"",is_cover_image:!1}}),EnviraAlbumGalleries=new Backbone.Collection,EnviraAlbumModalWindow=new wp.media.view.Modal({controller:{trigger:function(){}}}),EnviraAlbumEditView=wp.Backbone.View.extend({tagName:"div",className:"edit-attachment-frame mode-select hide-menu hide-router",template:wp.template("envira-albums-meta-editor"),events:{"click .edit-media-header .left":"loadPreviousItem","click .edit-media-header .right":"loadNextItem","click li.attachment":"updateCoverImage","keyup input":"updateItem","keyup textarea":"updateItem","change input":"updateItem","change textarea":"updateItem","blur textarea":"updateItem","change select":"updateItem","click .actions a.envira-gallery-meta-submit":"saveItem"},initialize:function(e){this.on("loading",this.loading,this),this.on("loaded",this.loaded,this),this.is_loading=!1,this.collection=e.collection,this.images_collection=new Backbone.Collection,this.child_views=e.child_views,this.gallery_id=e.gallery_id,this.gallery_index=0,this.search_timer="";var i=0;this.collection.each(function(e){return e.get("id")==this.gallery_id?(this.model=e,this.gallery_index=i,!1):void i++},this)},render:function(){return this.trigger("loading"),this.$el.html(this.template(this.model.attributes)),this.child_views.length>0&&this.child_views.forEach(function(e){var i=new e({model:this.model});this.$el.find("div.envira-addons").append(i.render().el)},this),this.$el.find("textarea[name=caption]").val(this.model.get("caption")),setTimeout(function(){quicktags({id:"caption",buttons:"strong,em,link,ul,ol,li,close"}),QTags._buttonsInit()},500),0==this.images_collection.length?wp.media.ajax("envira_albums_get_gallery_images",{context:this,data:{nonce:envira_albums_metabox.get_gallery_images_nonce,gallery_id:this.model.get("id")},success:function(e){images=[];for(var i in e)images.push(e[i]);var a=new Backbone.Collection(images);this.images_collection.add(a.models),this.images_collection.each(function(e){e.get("id")==this.model.get("cover_image_id")?e.set("is_cover_image",!0):e.get("src")==this.model.get("cover_image_url")?e.set("is_cover_image",!0):e.set("is_cover_image",!1),this.$el.find("ul.attachments").append(this.renderItem(e))},this),this.trigger("loaded")},error:function(e){this.trigger("loaded",e)}}):this.images_collection.each(function(e){e.get("id")==this.model.get("cover_image_id")?e.set("is_cover_image",!0):e.set("is_cover_image",!1),this.$el.find("ul.attachments").append(this.renderItem(e))},this),this},renderItem:function(e){var i=new wp.media.view.EnviraAlbumItem({model:e});return i.render().el},renderError:function(e){var i={};i.error=e;var a=new wp.media.view.EnviraAlbumError({model:i});return a.render().el},loading:function(){this.is_loading=!0,this.$el.find(".spinner").css("visibility","visible")},loaded:function(e){this.is_loading=!1,this.$el.find(".spinner").css("visibility","hidden"),"undefined"!=typeof e&&this.$el.find("ul.attachments").before(this.renderError(e))},loadPreviousItem:function(e){this.saveItem(e),this.updateItem(e),this.gallery_index--,this.model=this.collection.at(this.gallery_index),this.gallery_id=this.model.get("id"),this.images_collection=new Backbone.Collection,this.render()},loadNextItem:function(e){this.saveItem(e),this.updateItem(e),this.gallery_index++,this.model=this.collection.at(this.gallery_index),this.gallery_id=this.model.get("id"),this.images_collection=new Backbone.Collection,this.render()},updateCoverImage:function(e){var i=jQuery(e.currentTarget),a=jQuery("div.attachment-preview",i).attr("data-id");i.hasClass("selected")||(this.images_collection.each(function(e){e.get("id")==a&&(this.model.set("cover_image_id",e.get("id")),this.model.set("cover_image_url",e.get("src")),this.model.set("cover_image_url_thumb",e.get("thumb")),this.render())},this),i.addClass("selected details"))},updateItem:function(e){""!=e.target.name&&("checkbox"==e.target.type?value=e.target.checked?1:0:value=e.target.value,this.model.set(e.target.name,value))},saveItem:function(){this.trigger("loading"),wp.media.ajax("envira_albums_update_gallery",{context:this,data:{nonce:envira_albums_metabox.save_nonce,post_id:envira_albums_metabox.id,gallery_id:this.model.get("id"),meta:this.model.attributes},success:function(e){this.trigger("loaded loaded:success");var i=JSON.stringify(this.model.attributes),a=jQuery("ul#envira-album-drag-drop-area li#envira-gallery-"+this.model.get("id"));jQuery(a).attr("data-envira-album-gallery-model",i),jQuery("img",a).attr("src",this.model.get("cover_image_url_thumb")),jQuery("div.meta div.title",a).text(this.model.get("title"));var t=this.$el.find(".saved");t.fadeIn(),setTimeout(function(){t.fadeOut()},1500)},error:function(e){this.trigger("loaded loaded:error",e)}})}}),EnviraAlbumChildViews=[];jQuery(document).ready(function($){EnviraAlbumGalleriesUpdate(),$("#envira-albums").on("click","a.envira-gallery-modify-image",function(e){e.preventDefault(),EnviraAlbumGalleriesUpdate();var i=$(this).parent().data("envira-gallery");EnviraAlbumModalWindow.content(new EnviraAlbumEditView({collection:EnviraAlbumGalleries,child_views:EnviraAlbumChildViews,gallery_id:i})),EnviraAlbumModalWindow.open()})}),jQuery(document).ready(function($){$("li",$(envira_album_available_galleries)).draggable(envira_album_draggable_options),$(envira_album_available_galleries).on("click","li.envira-gallery-image",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected"),$("li.selected",$(envira_album_available_galleries)).length>0?$("a.envira-galleries-add").fadeIn():$("a.envira-galleries-add").fadeOut()}),$("a.envira-galleries-add").on("click",function(e){e.preventDefault(),$("p.drag-drop-info").hide(),$("li.selected",$(envira_album_available_galleries)).each(function(){$(this).removeClass("selected").appendTo($(envira_album_selected_galleries))}),$("a.envira-galleries-add").fadeOut(),$(envira_album_selected_galleries).trigger("sortupdate")})});var envira_albums_gallery_search="input#envira-albums-gallery-search",envira_albums_gallery_search_timer=null;jQuery(document).ready(function($){function e(e){e.length<3&&e.length>0||$.ajax({url:envira_albums_metabox.ajax,type:"post",async:!0,cache:!1,data:{action:"envira_albums_search_galleries",search_terms:e,post_id:envira_albums_metabox.id,nonce:envira_albums_metabox.search},success:function(e){e.length>0&&($(envira_album_available_galleries).html(e),$("li",$(envira_album_available_galleries)).draggable(envira_album_draggable_options)),envira_albums_gallery_search_timer=null},error:function(e,i,a){$("#envira-albums-main").before('<div class="error"><p>'+i.responseText+"</p></div>"),envira_albums_gallery_search_timer=null}})}$(envira_albums_gallery_search).keypress(function(e){13==e.keyCode&&e.preventDefault()}),$(envira_albums_gallery_search).keyup(function(i){envira_albums_gallery_search_timer&&window.clearTimeout(envira_albums_gallery_search_timer),envira_albums_gallery_search_timer=window.setTimeout(function(){e($(envira_albums_gallery_search).val())},500)}),$(envira_albums_gallery_search).on("search",function(){e("")})});var envira_album_selected_galleries="ul#envira-album-drag-drop-area",envira_album_available_galleries="ul#envira-albums-output",envira_album_container="#envira-album-main",envira_album_meta_container=".envira-gallery-meta-container",envira_album_draggable_options={helper:"clone",connectToSortable:"#envira-album-drag-drop-area",revert:"invalid"};jQuery(document).ready(function($){$(envira_album_selected_galleries).sortable({stop:function(e,i){$("p.drag-drop-info").addClass("hidden");var a=i.item,t=$(a).data("envira-gallery");$(a).attr("id","envira-gallery-"+t),i.item.removeClass("selected"),setTimeout(function(){$("li[data-envira-gallery='"+t+"']",$(envira_album_available_galleries)).remove()},100)}}),$(envira_album_selected_galleries).on("sortupdate",function(){EnviraAlbumGalleriesUpdate();var e=[],i=[];EnviraAlbumGalleries.each(function(a){e.push(a.get("id")),i.push(a.attributes)}),$("input[name=galleryIDs]").val(e.join(",")),$.ajax({url:envira_albums_metabox.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"envira_albums_sort_galleries",gallery_ids:e,galleries:i,post_id:envira_albums_metabox.id,nonce:envira_albums_metabox.sort},success:function(e){},error:function(e,i,a){$(envira_album_selected_galleries).before('<div class="error"><p>'+i.responseText+"</p></div>")}})})}),jQuery(document).ready(function($){$("#envira-albums-settings input:not([type=hidden]), #envira-albums-settings select").conditions([{conditions:{element:'[name="_eg_album_data[config][lightbox_theme]"]',type:"value",operator:"array",condition:["base","captioned","polaroid","showcase","sleek","subtle"]},actions:{"if":[{element:"#envira-config-lightbox-title-display-box, #envira-config-lightbox-arrows-box, #envira-config-lightbox-toolbar-box, #envira-config-supersize-box",action:"show"}]}},{conditions:{element:'[name="_eg_album_data[config][lightbox_theme]"]',type:"value",operator:"array",condition:["base_dark"]},actions:{"if":[{element:"#envira-config-lightbox-title-display-box, #envira-config-lightbox-arrows-box, #envira-config-lightbox-toolbar-box, #envira-config-supersize-box",action:"hide"}]}},{conditions:[{element:'[name="_eg_album_data[config][lightbox_theme]"]',type:"value",operator:"array",condition:["base","captioned","polaroid","showcase","sleek","subtle"]},{element:'[name="_eg_album_data[config][mobile_lightbox]"]',type:"checked",operator:"is"}],actions:{"if":{element:"#envira-config-mobile-arrows-box, #envira-config-mobile-toolbar-box",action:"show"},"else":{element:"#envira-config-mobile-arrows-box, #envira-config-mobile-toolbar-box",action:"hide"}}},{conditions:{element:'[name="_eg_album_data[config][mobile_lightbox]"]',type:"checked",operator:"is"},actions:{"if":{element:"#envira-config-mobile-touchwipe-box, #envira-config-mobile-touchwipe-close-box, #envira-config-mobile-thumbnails-box",action:"show"},"else":{element:"#envira-config-mobile-touchwipe-box, #envira-config-mobile-touchwipe-close-box, #envira-config-mobile-thumbnails-box",action:"hide"}}},{conditions:{element:'[name="_eg_album_data[config][css_animations]"]',type:"checked",operator:"is"},actions:{"if":[{element:"#envira-config-css-opacity-box",action:"show"}],"else":[{element:"#envira-config-css-opacity-box",action:"hide"}]}},{conditions:[{element:'[name="_eg_album_data[config][mobile_lightbox]"]',type:"checked",operator:"is"},{element:'[name="_eg_album_data[config][mobile_thumbnails]"]',type:"checked",operator:"is"}],actions:{"if":{element:"#envira-config-mobile-thumbnails-width-box, #envira-config-mobile-thumbnails-height-box",action:"show"},"else":{element:"#envira-config-mobile-thumbnails-width-box, #envira-config-mobile-thumbnails-height-box",action:"hide"}}},{conditions:[{element:'[name="_eg_album_data[config][lightbox_theme]"]',type:"value",operator:"array",condition:["base","captioned","polaroid","showcase","sleek","subtle"]},{element:'[name="_eg_album_data[config][thumbnails]"]',type:"checked",operator:"is"}],actions:{"if":{element:"#envira-config-thumbnails-position-box",action:"show"},"else":{element:"#envira-config-thumbnails-position-box",action:"hide"}}},{conditions:[{element:'[name="_eg_album_data[config][thumbnails]"]',type:"checked",operator:"is"}],actions:{"if":{element:"#envira-config-thumbnails-height-box, #envira-config-thumbnails-width-box",action:"show"},"else":{element:"#envira-config-thumbnails-height-box, #envira-config-thumbnails-width-box",action:"hide"}}},{conditions:{element:'[name="_eg_album_data[config][columns]"]',type:"value",operator:"array",condition:["0"]},actions:{"if":[{element:"#envira-config-album-theme-box",action:"hide"},{element:"#envira-config-album-justified-settings-box",action:"show"}],"else":[{element:"#envira-config-album-theme-box",action:"show"},{element:"#envira-config-album-justified-settings-box",action:"hide"}]}},{conditions:{element:'[name="_eg_album_data[config][back]"]',type:"checked",operator:"is"},actions:{"if":[{element:"#envira-config-back-label-box",action:"show"}],"else":[{element:"#envira-config-back-label-box",action:"hide"}]}},{conditions:{element:'[name="_eg_album_data[config][description_position]"]',type:"value",operator:"array",condition:["0"]},actions:{"if":[{element:"#envira-config-description-box",action:"hide"}],"else":[{element:"#envira-config-description-box",action:"show"}]}},{conditions:{element:'[name="_eg_album_data[config][sorting]"]',type:"value",operator:"array",condition:["0"]},actions:{"if":[{element:"#envira-config-sorting-direction-box",action:"hide"}],"else":[{element:"#envira-config-sorting-direction-box",action:"show"}]}},{conditions:{element:'[name="_eg_album_data[config][lightbox]"]',type:"checked",operator:"is"},actions:{"if":[{element:"#envira-lightbox-settings, #envira-thumbnails-settings",action:"show"}],"else":[{element:"#envira-lightbox-settings, #envira-thumbnails-settings",action:"hide"}]}},{conditions:[{element:'[name="_eg_album_data[config][arrows]"]',type:"checked",operator:"is"},{element:'[name="_eg_album_data[config][lightbox_theme]"]',type:"value",operator:"array",condition:["base","captioned","polaroid","showcase","sleek","subtle"]}],actions:{"if":[{element:"#envira-config-lightbox-arrows-position-box",action:"show"}],"else":[{element:"#envira-config-lightbox-arrows-position-box",action:"hide"}]}},{conditions:[{element:'[name="_eg_album_data[config][toolbar]"]',type:"checked",operator:"is"},{element:'[name="_eg_album_data[config][lightbox_theme]"]',type:"value",operator:"array",condition:["base","captioned","polaroid","showcase","sleek","subtle"]}],actions:{"if":[{element:"#envira-config-lightbox-toolbar-title-box, #envira-config-lightbox-toolbar-position-box",action:"show"}],"else":[{element:"#envira-config-lightbox-toolbar-title-box, #envira-config-lightbox-toolbar-position-box",action:"hide"}]}},{conditions:{element:'[name="_eg_album_data[config][mobile]"]',type:"checked",operator:"is"},actions:{"if":[{element:"#envira-config-mobile-size-box",action:"show"}],"else":[{element:"#envira-config-mobile-size-box",action:"hide"}]}}])});